datasource db {
  provider = "sqlite"
  url      = env("DB_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  GUEST
  USER
  CREATOR
  OFFICIAL
  MAINADMIN
}

enum EventType {
  Major
  Unofficial
  Desi
}

model User {
  id         Int          @id @default(autoincrement())
  email      String       @unique
  username   String?
  password   String
  role       Role         @default(USER)
  createdAt  DateTime     @default(now())

  events     Event[]      @relation("CreatedEvents")
  scores     Score[]
  friendships Friendship[] @relation("userFriendships")
  friendsOf  Friendship[] @relation("friendUserFriendships")
}

model Friendship {
  id        Int      @id @default(autoincrement())
  user      User     @relation("userFriendships", fields: [userId], references: [id])
  userId    Int
  friend    User     @relation("friendUserFriendships", fields: [friendId], references: [id])
  friendId  Int
  createdAt DateTime @default(now())

  @@unique([userId, friendId])
}

model Event {
  id           Int        @id @default(autoincrement())
  name         String     @unique
  type         EventType  @default(Unofficial)
  date         DateTime?
  creatorId    Int
  createdBy    User       @relation("CreatedEvents", fields: [creatorId], references: [id])
  participants Int

  scores       Score[]
}

model Score {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  eventId   Int
  event     Event    @relation(fields: [eventId], references: [id])
  strokes   Int
  points    Int
  createdAt DateTime @default(now())
}